# Dockerfile for validating Talend ESB Studio SE build artifacts
# Runs comprehensive checks on the built JARs

FROM tesb-studio-se:maven AS base

# Switch to JDK for compilation (alpine doesn't have javac in JRE)
FROM eclipse-temurin:8-jdk-alpine AS validator

# Install required tools
RUN apk add --no-cache bash bc unzip

WORKDIR /app

# Copy JARs from the built image
COPY --from=base /app/libs /app/libs

# Copy validation scripts
COPY validation/validate.sh /app/validation/
COPY validation/SmokeTest.java /app/validation/

# Make scripts executable
RUN chmod +x /app/validation/validate.sh

# Set environment
ENV JAR_DIR=/app/libs
ENV REPORT_DIR=/app/validation

# Run validation
CMD ["/app/validation/validate.sh"]
